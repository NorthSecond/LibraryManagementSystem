# 图书馆管理系统项目开发报告

<center> 20303068 杨翼飞</center>

## 1. 项目概述

本项目为课程“软件工程实训（初级）”中的课程报告大作业。使用 Qt + MySQL 进行开发，使用 Git 进行版本控制和项目管理。

本项目由我一人独立完成，不涉及小组分工。

## 2. 业务需求分析和基本的模块功能

### 业务需求分析

本系统主要涉及管理员端和用户端程序的编写。使用登录界面进行对应应用程序端口的选择，需要完成的用例如下：

* 用户登录
* 管理员信息更改
* 用户信息更改
* 用户信息管理
* 图书管理和信息修改
* 书目检索和查询
* 图书借阅
* 图书归还
* 超期以及损坏状态处理

### 基本模块功能

其中，主页面主要涉及的模块有：

* 用户登录
    * 功能：实现基本的用户登录和鉴权，引导至不同的用户权限列表


管理员页面涉及的模块有：

* 管理员信息更改
    * 功能：管理员修改自己的个人信息和账号密码等
* 用户信息管理
    * 功能：管理员实现用户个人信息的修改（无权修改用户密码）
* 图书归还
    * 功能：管理员检查并归还应还图书，如果图书有损坏，将图书标记为损坏
* 图书管理和信息修改
    * 功能：管理图书的基本信息和馆藏状态
* 超期以及损坏状态处理
    * 功能：对于违规账号（超期/损毁图书）的违规记录进行处理

用户页面涉及的模块有：

+ 书目检索和查询
    + 检索和查询馆藏书目
+ 图书借阅
    + 借阅选定的图书

## 3. 系统设计与实现

### 技术选型和依赖项

#### 技术选型

+ 使用 Windows 平台开发，开发工具为Qt Creator 9.0.1 Community
+ 数据库系统： MariaDB
+ 开发框架：Qt 6.3 + C++17标准框架，使用 MSVC 编译器编译

### 数据库设计

#### 概念结构设计

根据需求分析内容，我们进行相应的数据库概念结构的设计。我们对于系统定义图书信息，读者信息和管理员信息这三个实体，完善相应的联系和实体中对应的元素信息，绘制对应的E-R图如下：![image-20230113165913789](E:\Documents\学习\pics\初级实训报告\image-20230113165913789.png)

#### 数据库逻辑结构设计

在上方概念结构设计的基础上，我们进行逻辑结构设计，得到满足第三范式的逻辑结构设计如下：

> 读者信息（<u>读者id</u>，读者姓名，联系方式，所属类型，用户状态，已借书目，违规信息）
>
> 读者类型（<u>类型名</u>，借阅限量，时间限制）
>
> 管理员信息（<u>管理员工号</u>，管理员姓名，联系方式，岗位信息，在职状态）
>
> 图书信息（<u>索引号</u>，ISBN，图书状态）
>
> 图书详情（<u>ISBN</u>，书名，出版社信息，作者信息，语言信息，版号，图书简介）
>
> 借出记录（<u>流水号</u>，图书索引，读者id，借出时间，经办管理员工号）
>
> 归还记录（<u>流水号</u>，借出记录，归还时间，经办管理员工号）
>
> 违规信息（<u>流水号</u>，图书索引，读者id，违规时间，违规类型编号，违规状态）
>
> 联系方式（<u>用户id</u>，电话号码，电子邮件地址，住址，邮政编码）
>
> 作者信息（<u>作者编号</u>，作者姓名，国家信息，联系方式）
>
> 出版社信息（<u>出版社编号</u>，出版社名称，出版社地址，联系方式）
>
> 图书状态（<u>状态</u>，是否上架，是否可借出）
>
> 违规类型（<u>违规类型编号</u>，违规所属类型，惩罚措施）
>
> 违规状态（<u>状态编号</u>，状态内容，是否限制）

#### 数据库结构物理设计

根据概念结构设计和逻辑结构设计的内容，我们进行物理设计，关联图如下图所示：![image-20230113170232043](E:\Documents\学习\pics\初级实训报告\image-20230113170232043.png)

其中设计表的详细信息如下图所示：

##### 读者信息表设计


| 序号 | 列名          | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | ------------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Reader_id     | Bingint  |      | 主键 | 否     | 读者编号 |
| 2    | Reader_name   | Varchar  | 32   |      | 否     | 读者姓名 |
| 3    | Connect_info  | Bigint   |      | 外键 | 是     | 联系方式 |
| 4    | Reader_type   | Varchar  | 16   | 外键 | 否     | 读者类型 |
| 5    | Reader_status | Varchar  | 16   |      | 否     | 读者状态 |
| 6    | Borrowed_num  | Int      |      |      | 否     | 已借数目 |
| 7    | Banned_info   | int      |      | 外键 | 是     | 违规信息 |

 

##### 3.2.2 读者类型表设计


| 序号 | 列名       | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | ---------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Typename   | varchar  | 16   | 主键 | 否     | 类型     |
| 2    | Num_limit  | Int      |      |      | 否     | 数目限制 |
| 3    | Time_limit | datetime |      |      | 否     | 时间限制 |

 

##### 管理员信息表设计

| 序号 | 列名            | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | --------------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Admin_id        | Int      |      | 主键 | 否     | 工号     |
| 2    | Admin_name      | Varchar  | 32   |      | 否     | 姓名     |
| 3    | Connection_info | Int      |      | 外键 | 否     | 联系方式 |
| 4    | Post_info       | Varchar  | 64   |      | 否     | 岗位信息 |
| 5    | Work_status     | varchar  | 64   |      | 否     | 工作状态 |

 

##### 图书信息表设计

| 序号 | 列名        | 数据类型 | 长度 | 键值 | 允许空 | 说明       |
| ---- | ----------- | -------- | ---- | ---- | ------ | ---------- |
| 1    | Book_index  | Bingint  |      | 主键 | 否     | 图书索引号 |
| 2    | Book_ISBN   | Char     | 13   |      | 否     | ISBN       |
| 3    | Book_status | varchar  | 32   | 外键 | 否     | 图书状态   |

 

##### 图书详情表设计

| 序号 | 列名          | 数据类型   | 长度 | 键值 | 允许空 | 说明     |
| ---- | ------------- | ---------- | ---- | ---- | ------ | -------- |
| 1    | ISBN          | Char       | 13   | 主键 | 否     | ISBN     |
| 2    | Book_name     | Varchar    | 255  |      | 否     | 书名     |
| 3    | Pubish_info   | Int        |      | 外键 | 否     | 出版信息 |
| 4    | Author_info   | Int        |      | 外键 | 否     | 作者信息 |
| 5    | Language_info | Varchar    | 64   |      | 是     | 语言信息 |
| 6    | Book_version  | Int        |      |      | 是     | 版号     |
| 7    | Brief_intro   | mediumText |      |      | 是     | 图书简介 |

 

##### 借出记录表设计

| 序号 | 列名       | 数据类型 | 长度 | 键值 | 允许空 | 说明       |
| ---- | ---------- | -------- | ---- | ---- | ------ | ---------- |
| 1    | Id         | Int      |      | 主键 | 否     | 流水号     |
| 2    | Book_index | Bigint   |      | 外键 | 否     | 图书索引号 |
| 3    | Reader_id  | Int      |      | 外键 | 否     | 读者id     |
| 4    | Lend_time  | Datetime |      |      | 否     | 借出时间   |
| 5    | Admin_id   | Int      |      | 外键 | 否     | 管理员工号 |

 

##### 归还记录表设计


| 序号 | 列名        | 数据类型 | 长度 | 键值 | 允许空 | 说明       |
| ---- | ----------- | -------- | ---- | ---- | ------ | ---------- |
| 1    | Id          | Int      |      | 主键 | 否     | 流水号     |
| 2    | Lend_id     | Int      |      | 外键 | 否     | 出借流水号 |
| 3    | Return_time | Datetime |      |      | 否     | 归还时间   |
| 4    | Admin_id    | int      |      |      | 否     | 管理员工号 |

 

##### 违规信息表设计

| 序号 | 列名        | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | ----------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Id          | Int      |      | 主键 | 否     | 流水号   |
| 2    | Book_index  | Bigint   |      | 外键 | 否     | 图书索引 |
| 3    | Reader_id   | Bigint   |      | 外键 | 否     | 读者id   |
| 4    | Banned_time | Datetime |      |      | 否     | 违规时间 |
| 5    | Type_id     | Int      |      | 外键 | 否     | 违规类型 |
| 6    | status      | int      |      | 外键 | 否     | 违规状态 |

##### 联系方式表设计

| 序号 | 列名        | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | ----------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Id          | Bigint   |      | 主键 | 否     | 序号     |
| 2    | Telephone   | Varchar  | 64   |      | 是     | 电话号码 |
| 3    | e-mail      | Varchar  | 255  |      | 是     | 电子邮件 |
| 4    | Address     | Varchar  | 255  |      | 是     | 地址     |
| 5    | Postal_code | varchar  | 32   |      | 是     | 邮政编码 |

##### 作者信息表设计

| 序号 | 列名            | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | --------------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Author_index    | Int      |      | 主键 | 否     | 作者编号 |
| 2    | Author_name     | Varchar  | 64   |      | 否     | 作者姓名 |
| 3    | Nationality     | Varchar  | 64   |      | 是     | 作者国籍 |
| 4    | Connection_info | bigint   |      | 外键 | 是     | 联系方式 |

#####1 出版社信息表设计

| 序号 | 列名            | 数据类型 | 长度 | 键值 | 允许空 | 说明       |
| ---- | --------------- | -------- | ---- | ---- | ------ | ---------- |
| 1    | Press_index     | Int      |      | 主键 | 否     | 出版社编号 |
| 2    | Press_name      | varchar  | 127  | 主键 | 否     | 出版社名   |
| 3    | Address         | varchar  | 255  |      | 是     | 出版社地址 |
| 4    | Connection_info | bigint   |      |      | 是     | 联系方式   |

##### 图书状态表设计

| 序号 | 列名         | 数据类型 | 长度 | 键值 | 允许空 | 说明       |
| ---- | ------------ | -------- | ---- | ---- | ------ | ---------- |
| 1    | Book_status  | Varchar  | 32   | 主键 | 否     | 图书状态   |
| 2    | Is_on_shelf  | Tinyint  | 1    |      | 否     | 是否在架上 |
| 3    | Can_borrowed | tinyint  | 1    |      | 否     | 是否可借阅 |

##### 违规类型表设计

| 序号 | 列名       | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | ---------- | -------- | ---- | ---- | ------ | -------- |
| 1    | Type_id    | Int      |      | 主键 | 否     | 类型编号 |
| 2    | Type       | Varchar  | 63   |      | 否     | 所属类别 |
| 3    | Punishment | tinytext |      |      | 是     | 处罚方式 |

##### 违规状态表设计

| 序号 | 列名         | 数据类型 | 长度 | 键值 | 允许空 | 说明     |
| ---- | ------------ | -------- | ---- | ---- | ------ | -------- |
| 1    | Status_id    | Int      |      | 主键 | 否     | 状态编号 |
| 2    | Status_info  | Varchar  | 255  |      | 否     | 状态内容 |
| 3    | Is_refreshed | tinyint  | 1    |      | 否     | 是否恢复 |

### 功能详细设计

功能真题上采用 repository 的 DDD 设计模式进行设计，使用统一的数据库代理类，将数据库和对应的处理逻辑隔离起来，互不干扰进行操作。

![](https://learn.microsoft.com/en-us/previous-versions/msp-n-p/images/ff649690.4058e458-bd54-4597-845e-6f8b1a21cfc3(en-us,pandp.10).png)

同时用户界面端和用户逻辑也进行了一定的SQL防注入操作，防止恶意操作导致数据库被攻击。

而对于图书借阅，图书归还和违规处理这几个操作，我使用SQL事务来保证原子操作，防止由于程序异常运行导致数据库的信息异常发生。

## 4.系统测试

### 单元测试

项目每一个功能在开发完成后均进行了单元测试，保证项目可用性。

### 集成测试

项目开发完成后我进行了全面的集成测试，确保各功能组织情况正常，运行情况正常，相互无干扰，无运行错误情况发生。

## 5. 项目展望

项目后期可使用C/S架构进行重构，将对应的数据库和逻辑端口放置到服务器上进行处理，本地只负责界面显示和基本的前端逻辑操作验证。

在本学期的初级实训课程学习中，我相对全面的学习了 Qt 开发框架，了解了一个 GUI 程序是如何从代码渲染到显示器上的，为此后计算机图形学的有关学习奠定了一定的基础。